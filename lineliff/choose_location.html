<div class="md-range-event" id="main_form_register" mbsc-form style="display:none">
    <div class="md-header" style="padding:8px 0px 14px 0px;margin:0px;background-color:#206eb8;">
      <div class="mbsc-header-txt mbsc-align-center">
        <div class="mbsc-align-center" style="margin-top:8px;">
          <p style="padding:0px 5px;margin:0px;font-weight:400;font-size: 1.5rem;line-height: 2rem;color:white;">โครงการอยู่บ้าน ปอดปลอดภัย</p>
        </div>
      </div>
    </div>

    <div mbsc-form>
      <div mbsc-form id="form_display">
        <div class="mbsc-align-center" style="margin-top:20px;">
          <p style="margin-top:3px;margin-bottom:8px;;">
            เพื่อให้เป็นการสะดวกแก่เจ้าหน้าที่ในการจัดหาคิว และ ให้ท่านสะดวกในการเดินทาง
            <br>
            กรุณาเลือกศูนย์ให้บริการที่ท่านสะดวก</p>
            <font color="red"><small >*หากเลือกแล้วไม่สามารถเปลี่ยนแปลงได้</small></font>
        </div>



        <!-- form register -->
        <div id="form_choose_location" >
          <!-- 1 -->


          <div mbsc-form style="max-width:900px;" class="mbsc-align-center mbsc-btn-group-justified">
            <div class="mbsc-grid mbsc-form-grid">

                    <div class="mbsc-row">

                    <div class="mbsc-col-12">

                            <select mbsc-dropdown data-input-style="box" id="hospital" style="display: none;">
                                <option value="##HOSPITAL-id##">##HOSPITAL-name##</option>
                            </select>
                            <select mbsc-dropdown data-input-style="box" id="hospital_showing">

                            </select>

                    </div>
            </div>

            </div>
          </div>
              <div id="show_btn_save" class="mbsc-align-center mbsc-btn-group-justified">
                <button id="btn_register" mbsc-button type="button" class="mbsc-btn-outline btn_hover" onclick="hospitalSubmit()"
                  style="color:white !important; border:none !important ; border-radius:5px;padding:0px 50px;font-size:16px;font-weight:400;background-color:#206eb8;border-radius:5px;">
                  <div class="mbsc-form-grid">
                    <div class="mbsc-grid">
                      <div class="mbsc-row">
                        <div class="mbsc-col-12">
                          <p style="padding:0px;margin:0px;" id="text_edit_inbtn">บันทึก</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
            <div class="mbsc-row "  mbsc-form >

            <div class="mbsc-col-12  " >
               ข้อมูล สถานที่ของ ศูนย์ที่ให้บริการ

          <hr style="background-color: #58595B;opacity:0.5;">
              <div id="location_of_hosp">
                ชื่อ : <font color="blue">##hosp-name##</font>
                <br>
                สถานที่ที่ตั้ง : ##hosp-address##
                <br>
                ที่อยู่ละเอียด : <small>##hosp-lineaddress##</small>
                <hr>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>

<script>
    var hospitalNamelist;
    var appoint_detail_template = $("#hospital").html()
    $.getJSON(MAINURL + '/api-web/line/hospital/get', (msg) => {
          console.log(msg)
           // remove TEST Site
           for(var x=0; x < msg.length;x++){
             if(msg[x]._id < 3){
               msg.splice(x,1); x--;
             }
           }
           hospitalNamelist = hash_replace(appoint_detail_template, 'HOSPITAL', msg)
           $("#hospital_showing").html(hospitalNamelist)

           $('#hospital_showing').mobiscroll().select({
                display: 'bubble'
            });
           hash_replace($('#location_of_hosp'),"hosp",msg)
        })

        function hospitalSubmit()
        {

            let location = {
                type: "Point",
                coordinates: [0,0]
            }

            let hospital = parseInt($('#hospital_showing').val())

            var patientid = getParameterByName('id', window.location.search);

            let payload =
            {
                patient: patientid,
                hospital: hospital,
                location: location
            }
            console.log(payload)
            var call_url = MAINURL + "/api-web/line/patient/reappoint/";
            if(ACTIVEPATIENT){  // ทำรายการแทนกัน
              call_url  += ACTIVEPATIENT._id
            }else{
              call_url  += GLOBALUSER._id
            }
            $.postJSON(call_url,payload,(msg) =>
            {
                if (msg.code == 200)
                {
                    alert_modal("บันทึกข้อมูลแล้ว")
                    setTimeout(()=>{
                      go2View("queuecheck")
                    },1500);
                    return
                }
                else
                {
                    return alert_modal("เกิดปัญหาระหว่างบันทึกข้อมูล โปรดลองใหม่อีกครั้ง")
                }
            })
        }
</script>
