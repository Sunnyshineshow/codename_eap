<div class="md-range-event" mbsc-form>
    <div class="md-header" style="padding:8px 0px 14px 0px;margin:0px;background-color:#206eb8;">
      <div class="mbsc-header-txt mbsc-align-center">
        <div class="mbsc-align-center" style="margin-top:8px;">
          <p style="padding:0px 5px;margin:0px;font-weight:400;font-size: 1.5rem;line-height: 2rem;color:white;">โครงการช่วยเหลือผู้ป่วยโควิดฉุกเฉิน สำหรับผู้ป่วยรักษาตัวที่บ้าน</p>
          <p style="padding:0px 5px;margin:0px;font-weight:400;font-size:12px;color:white;">Emergency Assistance for Home stay Patients Project ( EAP )</p>
        </div>
      </div>
    </div>
  </div>


  <div mbsc-form>

    <div class="mbsc-align-center" style="margin-top:20px;">
      <p id="title_address" style="margin-top:3px;margin-bottom:8px;"> อาการเบื้องต้น</p>
    </div>

    <div style="padding:0px 15px 0px 15px;margin: 25px 0px 20px 0px;">
      <hr style="background-color: #58595B;opacity:0.5;">
    </div>

    <div class="mbsc-align-left" style="margin-left: 18px;margin-top:25px;">
      <span style="padding:5px 11px;margin:0px;font-size:14px;font-weight:400;background-color:#206eb8;border-radius:50px;color:white;">1.</span>
      <span style="font-size:14px;font-weight:400;color:#0b9fd5;"> อาการเบื้องต้น (Initial Symptoms)</span> <label style="padding:0px;margin:0px;margin-left: 18px;font-weight:400;font-size:14px;">ถ้ามี (if any)</label>
      <!-- <div class="mbsc-form-group-title"><span style="color:red"> *</span> ถ้ามี (if any)</div> -->
    </div>
  
    <div style="padding:0px;margin:0px;">
      <div class="mbsc-grid mbsc-align-left" style="padding:0px;margin:0px;">
        <div class="mbsc-row" style="padding:0px;margin:0px;margin-top:5px">
          <div class="mbsc-col-12" style="padding:0px;margin:0px;">
            <div id="input_nametitle" style="border-radius:0px !important;padding:0px;margin-top:15px;">
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!---  select อันนี้ไม่สามารถอยู่ใน mobiscroll form ได้  มันจะแสดงค่าที่เลือก ให้เห็น-->
  <div>
    <select multiple="multiple" class="form-control tag-keyword" placeholder="kiosk tags" id="tags" rows="3" style="margin:10px 10px !important;"></select>
  </div>

  <div mbsc-form>
    <div mbsc-form id="form_display">
      <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:25px;margin-bottom:12px;">
        <span style="padding:5px 11px;margin:0px;font-size:14px;font-weight:400;background-color:#206eb8;border-radius:50px;color:white;">2.</span>
        <span style="font-size:14px;font-weight:400;color:#0b9fd5;"> ภาวะเสี่ยง/โรคร่วม</span>
        <p style="padding:0px;margin:0px;font-weight:400;font-size:14px;margin-top:12px;">หากท่านมีอาการดังนี้ กรุณาระบุ หากไม่มี ไม่ต้องระบุ</p>
      </div>

      <div mbsc-card style="display:none;margin-top:0px;margin-bottom:0px;border-radius:0px;">
        <div class="mbsc-card-content" style="padding-top:0px;margin-top:0px;border-radius:0px;">
          <div style="padding:0px;margin:0px;">
            <div class="mbsc-grid mbsc-align-left" style="padding:0px;margin:0px;">
              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="lung_disease" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="lung_disease"><span style="font-size:14px;font-weight:400;"> โรคปอด</span> </label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="kidney_disease" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="kidney_disease"><span style="font-size:14px;font-weight:400;"> โรคไตเรื้อรัง</span></label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="heart_disease" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="heart_disease"><span style="font-size:14px;font-weight:400;"> โรคหัวใจและหลอดเลือด รวมโรคหัวใจแต่กำเนิด</span></label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="cerebro_disease" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="cerebro_disease"><span style="font-size:14px;font-weight:400;"> โรคหลอดเลือดสมอง (Stroke)</span></label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="diabetes" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="diabetes"><span style="font-size:14px;font-weight:400;"> เบาหวานที่ควบคุมไม่ได้</span></label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="cirrhosis" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="cirrhosis"><span style="font-size:14px;font-weight:400;"> ตับแข็ง</span></label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="obese" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="obese"><span style="font-size:14px;font-weight:400;"> อ้วน น้ำหนัก > 90 Kg</span></label>
              </div>

              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="low_immune" mbsc-checkbox type="checkbox">
                </div>
                <divs class="mbsc-col-9">
                  <label for="low_immune"><span style="font-size:14px;font-weight:400;"> ภูมิต้านทานต่ำ / WBC น้อยกว่า 1,000</span></label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:25px;">
        <span style="padding:5px 11px;margin:0px;font-size:14px;font-weight:400;background-color:#206eb8;border-radius:50px;color:white;">3.</span>
        <span style="font-size:14px;font-weight:400;color:#0b9fd5;"> อาการที่ต้องตรวจประมิน</span>
      </div>

      <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:25px;margin-bottom:12px;">
        <p style="padding:0px;margin:0px;font-weight:400;font-size:14px;margin-top:12px;">1. การหายใจ <span style="color:red"> *</span></p>
      </div>

      <div mbsc-card style="display:none;margin-top:0px;margin-bottom:0px;border-radius:0px;">
        <div class="mbsc-card-content" style="padding-top:0px;margin-top:0px;border-radius:0px;">
          <div style="padding:0px;margin:0px;">
            <div class="mbsc-grid mbsc-align-left" style="padding:0px;margin:0px;">
              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="normal_breathe" mbsc-checkbox type="radio" name="breathe_status">
                </div>
                <div class="mbsc-col-9">
                  <label for="normal_breathe"><span style="font-size:14px;font-weight:400;"> หายใจปกติ</span></label>
                </div>
              </div>
              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="heavy_breathe" mbsc-checkbox type="radio" name="breathe_status">
                </div>
                <div class="mbsc-col-9">
                  <label for="heavy_breathe"><span style="font-size:14px;font-weight:400;"> เหนื่อยหอบ</span></label>
                </div>
              </div>
              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="hard_breathe" mbsc-checkbox type="radio" name="breathe_status">
                </div>
                <div class="mbsc-col-9">
                  <label for="hard_breathe"><span style="font-size:14px;font-weight:400;"> หายใจลำบาก</span></label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:25px;">
        <p style="padding:0px;margin:0px;font-weight:400;font-size:14px;margin-top:12px;">2. ค่าออกซิเจนในเลือด (SpO2 room air) .%<span style="color:red"> *</span></p>
      </div>

      <div style="padding:0px;margin:0px;">
        <div class="mbsc-grid mbsc-align-left" style="padding:0px;margin:0px;">
          <div class="mbsc-row" style="padding:0px;margin:0px;">
            <div class="mbsc-col-12" style="padding:0px;margin:0px;">
              <div id="spO2" style="border-radius:0px !important;padding:0px;margin-top:10px;">
                <div id="input_spO2" style="border-radius:0px !important;padding:0px;margin-top:10px;">
                  <div class="mbsc-form-group-inset" style="padding:0px 15px 0px 15px;margin:0px;">
                    <div id="inputbox_spO2">
                      <label>
                        <input style="border:1 solid gray;" class="mbsc-align-left" mbsc-input id="spO2_input" type="text" inputmode="numeric" name="spO2" placeholder=""
                          oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" maxlength="10" style="font-size: 13px;" />
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
            <div mbsc-form class="mbsc-col-2 mbsc-checkbox-success" style="padding-left:0px;margin:0px;background-color:transparent;">
              <input id="spO2_unknown" mbsc-checkbox type="checkbox" onclick="checkToDisable()">
            </div>
            <div class="mbsc-col-9">
              <label for="spO2_unknown"><span style="font-size:14px;font-weight:400;"> ไม่ทราบค่า</span></label>
            </div>
          </div>
        </div>
      </div>

      <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:12px;">
        <p style="padding:0px;margin:0px;font-weight:400;font-size:14px;margin-top:12px;">3. ทดสอบภาวะการขาดออกซิเจน โดยการออกกำลังกาย .%<span style="color:red"> *</span></p>
      </div>

      <div style="padding:0px;margin:0px;">
        <div class="mbsc-grid mbsc-align-left" style="padding:0px;margin:0px;">
          <div class="mbsc-row" style="padding:0px;margin:0px;">
            <div class="mbsc-col-12" style="padding:0px;margin:0px;">
              <div id="X2O" style="border-radius:0px !important;padding:0px;margin-top:10px;">
                <div id="input_X2O" style="border-radius:0px !important;padding:0px;margin-top:10px;">
                  <div class="mbsc-form-group-inset" style="padding:0px 15px 0px 15px;margin:0px;">
                    <div id="inputbox_X2O">
                      <label>
                        <input style="border:1 solid gray;" class="mbsc-align-left" mbsc-input id="X2O_input" type="text" inputmode="numeric" name="X2O" placeholder=""
                          oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" maxlength="10" style="font-size: 13px;" />
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
            <div mbsc-form class="mbsc-col-2 mbsc-checkbox-success" style="padding-left:0px;margin:0px;background-color:transparent;">
              <input id="X2O_unknown" mbsc-checkbox type="checkbox" onclick="checkToDisable()">
            </div>
            <div class="mbsc-col-9">
              <label for="X2O_unknown"><span style="font-size:14px;font-weight:400;"> ไม่ทราบค่า</span></label>
            </div>
          </div>
        </div>
      </div>


      <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:25px;margin-bottom:12px;">
        <span style="padding:5px 11px;margin:0px;font-size:14px;font-weight:400;background-color:#206eb8;border-radius:50px;color:white;">4.</span>
        <span style="font-size:14px;font-weight:400;color:#0b9fd5;"> ข้อมูลเพิ่มเติม</span>
        <p style="padding:0px;margin:0px;font-weight:400;font-size:14px;margin-top:12px;">กรุณาระบุข้อมูลเพิ่มเติม<span style="color:red"> *</span></p>
      </div>

      <div mbsc-card style="display:none;margin-top:0px;margin-bottom:0px;border-radius:0px;">
        <div id="title_more" class="mbsc-align-left" style="margin-left: 18px;margin-top:12px;margin-bottom:12px;">
          <p style="padding:0px;margin:0px;font-weight:400;font-size:14px;margin-top:12px;">ท่านเคยได้รับแจ้งว่ามีอาการปอดอักเสบมาก่อนหรือไม่ <span style="color:red"> *</span></p>
        </div>
        <div class="mbsc-card-content" style="padding-top:0px;margin-top:0px;border-radius:0px;">
          <div style="padding:0px;margin:0px;">
            <div class="mbsc-grid mbsc-align-left" style="padding:0px;margin:0px;">
              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="pneumonia_true" name = "pneumonia" mbsc-checkbox type="radio">
                </div>
                <div class="mbsc-col-9">
                  <label for="pneumonia_true"><span style="font-size:14px;font-weight:400;"> เคย</span></label>
                </div>
              </div>
              <div class="mbsc-row" style="padding:0px;margin:0px; margin-top:12px;">
                <div mbsc-form class="mbsc-col-2 mbsc-checkbox-primary" style="padding-left:0px;margin:0px;background-color:transparent;">
                  <input id="pneumonia_false" name = "pneumonia" mbsc-checkbox type="radio">
                </div>
                <div class="mbsc-col-9">
                  <label for="pneumonia_false"><span style="font-size:14px;font-weight:400;"> ไม่เคย</span></label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mbsc-row" style="padding:0px;margin:0px;margin-top:5px">
        <div class="mbsc-col-12" style="padding:0px;margin:0px;">
          <div id="input_checkdate" style="border-radius:0px !important;padding:0px;margin-top:10px;">
            <p style="padding:0px;margin:0px;margin-left: 18px;font-weight:400;font-size:14px;">วันที่พบอาการ (Date of Symptoms) <span style="color:red"> *</span></p>
            <label style="font-weight:600;font-size:14px; padding:0px 15px 0px 15px;margin:0px;" class="mbsc-align-left" id="checkdate" name="checkdate" placeholder="" maxlength="30" style="font-size: 13px;" value="" readonly></label>            
          </div>
        </div>
      </div>


      <div class="mbsc-row" style="padding:0px;margin:0px;margin-top:5px">
        <div class="mbsc-col-12" style="padding:0px;margin:0px;">
          <div id="input_comment" style="border-radius:0px !important;padding:0px;margin-top:10px;">
            <p style="padding:0px;margin:0px;margin-left: 18px;font-weight:400;font-size:14px;">ข้อมูลอื่น ๆ</p>
            <div class="mbsc-form-group-inset" style="padding:0px 15px 0px 15px;margin:0px;margin-top:5px;">
              <div id="inputbox_comment">
                <label>
                  <textarea id="comment" type="text" name="comment" rows="3" cols="266" class="mbsc-align-left" style="font-size: 13px;"></textarea>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="show_btn_save" class="mbsc-align-center mbsc-btn-group-justified">
        <button id="btn_register" mbsc-button type="button" class="mbsc-btn-outline btn_hover" onclick=""
          style="color:white !important; border:none !important ; border-radius:5px;padding:0px 50px;font-size:16px;font-weight:400;background-color:#206eb8;border-radius:5px;">
          <div class="mbsc-form-grid">
            <div class="mbsc-grid">
              <div class="mbsc-row">
                <div class="mbsc-col-12">
                  <p style="padding:0px;margin:0px;" id="text_edit_inbtn" onclick="checksymptoms()">บันทึก</p>
                </div>
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>
  </div>

  <script>

    $('#tags').adv_tags();

    function checksymptoms() {
      $('#tags').adv_tags();
      var postData = {
        symptom: $('#tags').adv_gettags()
      }
      console.log(postData)
      initSymptomSubmit(postData)
    }

    $(document).ready(function() {
      // $('#checkdate').mobiscroll().calendar({
      //   dateFormat: 'dd/mm/yyyy',
      //   display: 'center',
      //   touchUi: false,
      //   max: new Date(new Date().setDate(new Date().getDate())),
      // })

      let datetime = new Date()

      document.getElementById('checkdate').innerHTML = datetime.getDate() + "/"
      + (datetime.getMonth() + 1) + "/" + datetime.getFullYear()

      $("#title_address").scrollTop();

    })

    function checkToDisable()
    {
        if (document.getElementById("spO2_unknown").checked)
        {
          document.getElementById('spO2_input').disabled = true;                
          document.getElementById("spO2_input").style.display = "none";         
        }
        else
        {
          document.getElementById('spO2_input').disabled = false;
          document.getElementById("spO2_input").style.display = "block";
        }

        if (document.getElementById("X2O_unknown").checked)
        {
          document.getElementById('X2O_input').disabled = true;           
          document.getElementById("X2O_input").style.display = "none";         
        }
        else
        {
          document.getElementById('X2O_input').disabled = false;
          document.getElementById("X2O_input").style.display = "block"; 
        }
    }

    function initSymptomSubmit(symptoms)
    {
        //Var init
        let disease = [];
        let diseaseDict =
        {
            lung_disease: "โรคปอด",
            kidney_disease: "โรคไตเรื้อรัง",
            heart_disease: "โรคหัวใจและหลอดเลือด รวมโรคหัวใจแต่กำเนิด",
            cerebro_disease: "โรคหลอดเลือดสมอง (Stroke)",
            diabetes: "เบาหวานที่ควบคุมไม่ได้",
            cirrhosis: "ตับแข็ง",
            obese:"อ้วน น้ำหนัก > 90 Kg",
            low_immune: "ภูมิต้านทานต่ำ / WBC น้อยกว่า 1,000"
        };

        let breathing;
        let spo_room_air = $("#spO2_input").val();
        let exercise_test = $("#X2O_input").val();
        let pneumonia_check;
        let comment = $("#comment").val()

        //Disease
        let keys = Object.keys(diseaseDict);
        for (let i in keys)
        {
            if(document.getElementById(keys[i]).checked)
            {
                disease.push(diseaseDict[keys[i]])
            }
        }

        //breathing
        if (document.getElementById('normal_breathe').checked)
        {
            breathing = "normal"
        }
        else if (document.getElementById('heavy_breathe').checked)
        {
            breathing = "heavy"
        }
        else if (document.getElementById('hard_breathe').checked)
        {
            breathing = "hard"
        }
        else
        {
            //โยน Error
            return alert_modal("กรุณาเลือกการหายใจ")
        }

        //SpO2
        if (!spo_room_air)
        {
            if (document.getElementById("spO2_unknown").checked)
            {
                spo_room_air = -1;
            }
            else
            {
                //โยน Error
                return alert_modal("กรุณากรอกค่าออกซิเจนในเลือด หรือระบุว่าไม่ทราบค่า")
            }
        }

        if ((spo_room_air < 0 || spo_room_air > 100) && !(document.getElementById("spO2_unknown").checked))
        {
          return alert_modal("กรุณากรอกค่าออกซิเจนในเลือดให้ถูกต้อง")
        }

        if (document.getElementById("spO2_unknown").checked)
            {
                spo_room_air = -1;
            }

        //X2O
        if (!exercise_test)
        {
            if (document.getElementById("X2O_unknown").checked)
            {
                exercise_test = -1;
            }
            else
            {
                //โยน Error
                return alert_modal("กรุณากรอกค่าหลังทดสอบภาวะการขาดออกซิเจน หรือระบุว่าไม่ทราบค่า")
            }
        }

        if ((exercise_test < 0 || exercise_test > 100) && !(document.getElementById("X2O_unknown").checked))
        {
          return alert_modal("กรุณากรอกค่าหลังทดสอบภาวะการขาดออกซิเจนในเลือดให้ถูกต้อง")
        }


        if (document.getElementById("X2O_unknown").checked)
            {
                exercise_test = -1;
            }

        //pneumonia
        if (document.getElementById("pneumonia_true").checked)
        {
            pneumonia_check = true;
        }
        else if (document.getElementById("pneumonia_false").checked)
        {
            pneumonia_check = false;
        }
        else
        {
            //โยน Error
            return alert_modal("กรุณาระบุว่าเคยได้รับแจ้งว่ามีอาการปอดอักเสบมาก่อนหรือไม่")
        }

        let initial_symptoms =
            {
            symptoms : symptoms.symptom,
            disease: disease,
            breathing: breathing,
            spo_room_air: spo_room_air,
            exercise_test: exercise_test,
            pneumonia_check: pneumonia_check,
            checkdate: Math.floor((new Date()) / 1000),
            comment: comment
            }

            document.getElementById('btn_register').disabled = true;
            document.getElementById('text_edit_inbtn').innerHTML = "โปรดรอซักครู่"
            $.postJSON(MAINURL + "/api-web/line/regis_symptoms/", initial_symptoms, (msg) =>
            {
                var responselinemsg =[{
                    type: "text",
                    text: "ลงทะเบียนสำเร็จ"
                }]
                if(msg.responselinemsg){
                   responselinemsg= msg.responselinemsg;
                }
                liff.sendMessages(responselinemsg).then(() =>
                {
                    console.log("Logged to patient's Line")
                }).catch((err) => {
                    console.log('error', err)
                })

                go2View("alreadyregister")
                return alert_modal("ลงทะเบียนสำเร็จ")

            })
    }

  </script>
