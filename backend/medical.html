<div class="main_page mb-5" style="margin-top:120px;">
    <div class="p-2 mr-5 ml-5">
      <div class="container">
  
        <h3 class="p-0 m-0 mb-3"><b>Treatment (อยู่ระหว่างการพัฒนา)</b></h3>
        <h4 class="p-0 m-0 mb-3"><b>Medical</b></h4>
        <div class="row mb-1 d-flex justify-content-start">
          <div class="col-12 col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <form class="form-row" onsubmit="return pre_search();">
              <div class="row d-flex justify-content-center ">
                <div class="col-12 col-sm-12 col-md-6 col-lg-2 col-xl-2 mt-2">
                  <div class="form-group">
                    <input type="text" class="form-control" id="search_idno" placeholder="ID">
                  </div>
                </div>
                <div class="col-12 col-sm-12 col-md-6 col-lg-2 col-xl-2 mt-2">
                  <input type="text" class="form-control" id="search_name" placeholder="ชื่อ">
                </div>
                <div class="col-12 col-sm-12 col-md-6 col-lg-2 col-xl-2 mt-2">
                  <input type="text" class="form-control" id="search_cid" placeholder="เลขบัตรประชาชน">
                </div>
                <!--<div class="col-12 col-sm-12 col-md-6 col-lg-2 col-xl-2 mt-2">
                  <div class="form-group">
                    <select class="form-select" aria-label="สีของผู้ป่วย" id="search_color">
                      <option value="NONE">โปรดเลือกสี</option>
                      <option value="GREEN">เขียว</option>
                      <option value="YELLOW">เหลือง</option>
                      <option value="RED">แดง</option>
                      <option value="WHITE">สิ้นสุด</option>
                    </select>
                  </div>
                </div> -->
                <!--<div class="col-12 col-sm-12 col-md-6 col-lg-2 col-xl-2 mt-2">
                  <div class="form-group">
                    <select class="form-select" aria-label="สีของผู้ป่วย" id="search_color">
                      <option value="NONE">โปรดเลือกการเปลี่ยนแปลง</option>
                      <option value="-1">ดีขึ้น</option>
                      <option value="0">ปกติ</option>
                      <option value="1">แย่ลง</option>
                    </select>
                  </div>
                </div> -->
                <div class="col-12 col-sm-12 col-md-6 col-lg-2 col-xl-2 mt-2">
                  <div class="form-group">
                    <button type="submit" class="btn btn-primary border-0">
                      <i class="fas fa-search"></i>
                      Search
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
  
        <div style="width: 100%;height: 1px;border-bottom: 1px dashed #ddd;margin-top: 30px;margin-bottom:30px;"></div>
  
        <!-- แบ่งหน้า -->
        <div class="row mt-4">
          <div class="col-12 col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="pagination_bar pb-3"></div>
          </div>
        </div>
        <!-- // แบ่งหน้า -->
  
        <div class="table-responsive mt-2">
          <table class="table table-bordered table-hover show_startpage font-weight-light" >
            <thead class="text-center">
              <tr>
                <th scope="col" class="text-secondary">Profile</th>
                <th scope="col" class="text-secondary">Appointment ID</th>
                <th scope="col" class="text-secondary">Patient ID</th>
                <th scope="col" class="text-secondary">Name</th>
                <th scope="col" class="text-secondary">Date</th>
                <th scope="col" class="text-secondary">Favipilavia</th>
                <th scope="col" class="text-secondary">Other</th>
                <th scope="col" class="text-secondary">Action</th>
              </tr>
            </thead>
            <tbody id="row_patientlist" style="display:none;">
              <tr>
                <td class="text-center table-middle">
                  <img src="##MED-patient.pictureUrl##" style="max-width:50px;" class="rounded-circle">
                </td>
                <td class="text-center table-middle"># ##MED-appointment.id##</td>
                <td class="text-center table-middle"># ##MED-patient.id##</td>
                <td class="text-center table-middle">##MED-patient.displayName##
                  <br>
                  ##MED-patient.firstname## ##MED-patient.lastname##
                </td>
                <td class="text-center table-middle">##MED-createdate##</td>
                <td class="text-center table-middle">##MED-medicine.medic_favipilavia##</td>
                <td class="text-center table-middle">##MED-medicine.medic_other##</td>
                <td class="text-center">
                  <button type="button" name="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="appointment('##patient-id##')" disabled> comming soon</button>
                </td>
              </tr>
            </tbody>
            <tbody id="show_patientlist">
              <tr>
  
              </tr>
            </tbody>
          </table>
        </div>
        <!-- // end table -->
  
      </div>
    </div>
  </div>
  
    <script type="text/javascript">
    var template_patient_row = $('#row_patientlist').html();
    var searchobj = {};
    var fncsearch;
    // var global_color;
  
    function pre_search(){
      // clear search url from lastsearch
  
      refreshpage(undefined,true);
      return false;
    }
    function refreshpage(rawdata,clearsearch) {
      console.log("GLOBAL_USER",GLOBAL_USER)
  
      var search_setting = {
        posturl: '/api-backend/admin/treatment_medlist',
        paginationDIV: $('.pagination_bar'),
        pagesize: 10,
        showfunction: show_patient_list,
        limit: 20,
        search: {}
      }
      if ($('#search_name').val() !== "") {
        Object.assign(search_setting.search,{findname: $('#search_name').val()})
      }
  
      if ($('#search_idno').val() !== "") {
        Object.assign(search_setting.search,{find_id: $('#search_idno').val()})
      }
  
      console.log("Searching..",search_setting)
      // else
      // {
      //   Object.assign(search_setting.search,{find_color: undefined})
      // }
  
      console.log(search_setting.search)
  
      // if (global_color) {
      //   Object.assign(search_setting.search,{find_color: global_color})
      // }
      var pagenumber = getParameterByName('page', window.location.search);
      if (pagenumber > 1) {
        search_setting.page = pagenumber;
      }
      // console.log('SEARCH ', search_setting);
      fncsearch = ADV_search(search_setting,clearsearch); // Defult always search at first
      return false;
    }
  
    function show_patient_list(objdata, totalrecord) {
      // console.log('objdata', objdata);
      if (objdata.result && totalrecord > 0) {
        working.patient = objdata.obj;
        console.log("OBJDATA: " + objdata.obj)
  
        objdata.obj.map(item => {
          // console.log(item)
          // let datetime = new Date(res.symptoms[i].inputdate)
          // res.symptoms[i].inputdate = datetime.getDate() + "/"
          // + (datetime.getMonth() + 1) + "/" + datetime.getFullYear()
          // item.init_symptoms ? item.day_count =  moment(item.init_symptoms.checkdate, "X").fromNow(true) : item.day_count = "N/A"
  
          item.createdate ? item.createdate = moment(item.createdate, "X").format("DD/MM/YYYY HH:mm") : "";
          //  item.status = STATUSSHOW[item.status] || "ไม่มีข้อมูล";
          //  if (item.color == "RED") {
          //    item.color = '<span style="color: #C70039;">RED</span>'
          //  } else if (item.color == "YELLOW") {
          //    item.color = '<span style="color: #fcba03;">YELLOW</span>'
          //  } else if (item.color == "GREEN") {
          //    item.color = '<span style="color: green;">GREEN</span>'
          //  }else if (item.color == "WHITE") {
          //     item.color = 'สิ้งสุดกระบวนการ'
          //   }else{
          //    item.color = "N/A"
          //  }
          // // item.createDate ? item.createdate = datetime.getDate() + "/" + (datetime.getMonth() + 1) + "/" + datetime.getFullYear() :
          // if (item.color_change > 0)
          // {
          //   item.color_change = '<span style="color: #C70039;"> +' + item.color_change +'</span>'
          // }
          // else if (item.color_change < 0)
          // {
          //   item.color_change = '<span style="color: green;">' + item.color_change +'</span>'
          // }
          // else if (item.color_change == 0)
          // {
          //   item.color_change == 0
          // }
          // else
          // {
          //   item.color_change = "-"
          // }
  
        })
  
        var html_row = hash_replace(template_patient_row, 'MED', objdata.obj)
        $("#show_patientlist").html(html_row);
        // $('.show_startpage').show('slow');
  
      } else {
        $("#show_patientlist").html('<tr><td colspan="100%" class="text-center"><span class="text-sub">Data not found</span></td></tr>');
      }
    }
  </script>